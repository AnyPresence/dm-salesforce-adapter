#!/usr/bin/env ruby
require "rubygems"
require File.join(File.dirname(__FILE__), "common")

gems_dir = File.join(File.dirname(__FILE__), '..', 'gems')

if File.directory?(gems_dir)
  $BUNDLE = true
  Gem.clear_paths
  Gem.path.replace([File.expand_path(gems_dir)])
  ENV["PATH"] = "#{File.dirname(__FILE__)}:#{ENV["PATH"]}"
  
  gem_file = File.join(gems_dir, "specifications", "rake-*.gemspec")
  
  if local_gem = Dir[gem_file].last
    version = File.basename(local_gem)[/-([\.\d]+)\.gemspec$/, 1]
  end
end

version ||= ">= 0"

if ARGV.first =~ /^_(.*)_$/ and Gem::Version.correct? $1 then
  version = $1
  ARGV.shift
end

module DataMapperSalesforce
  UserDetails = Struct.new(:username, :password)
end

require 'pp'
require 'irb'
require 'dm-core'
require File.dirname(__FILE__)+'/../lib/dm-salesforce'
require File.dirname(__FILE__)+'/../spec/fixtures/account'
require File.dirname(__FILE__)+'/../spec/fixtures/contact'
require 'config/database'
if __FILE__ == $0
  IRB.start(__FILE__)
else
  # check -e option
  if /^-e$/ =~ $0
    IRB.start(__FILE__)
  else
    IRB.setup(__FILE__)
  end
end

